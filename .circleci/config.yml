version: 2
jobs:
  build:
    branches:
      only:
        - master
    docker:
      - image: andthensome/alpine-hugo-git-bash
    steps:
      - checkout
      - run:
          name: Upgrade hugo
          command: |
            apk update && apk add ca-certificates && update-ca-certificates && apk add openssl && apk add openssh-client
            wget https://github.com/gohugoio/hugo/releases/download/v0.85.0/hugo_0.85.0_Linux-64bit.tar.gz
            tar xzf hugo_0.85.0_Linux-64bit.tar.gz -C /usr/local/bin/ 
      - run:
          name: Install npm 
          command: |
            apk add --update npm && apk add nodejs-current
      - run:
          name: Config git
          command: |
            git config --global user.email "hoangmnsd@gmail.com"
            git config --global user.name "Hoangmnsd"
      - run:
          name: Publish site to github
          command: sh publish.sh
